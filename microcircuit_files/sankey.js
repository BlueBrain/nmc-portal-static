d3.sankey=function(){var q={},l=24,f=8,p=[1,1],d=[],n=[];q.nodeWidth=function(r){if(!arguments.length){return l}l=+r;return q};q.nodePadding=function(r){if(!arguments.length){return f}f=+r;return q};q.nodes=function(r){if(!arguments.length){return d}d=r;return q};q.links=function(r){if(!arguments.length){return n}n=r;return q};q.size=function(r){if(!arguments.length){return p}p=r;return q};q.layoutTest=function(r){c();h();g();return m(r)};q.layout=function(r){c();h();g();o(r);b();return q};q.relayout=function(){b();return q};q.link=function(){var s=0.5;function r(A){var x=A.source.x+A.source.dx,w=A.target.x,v=d3.interpolateNumber(x,w),u=v(s),t=v(1-s),z=A.source.y+A.sy+A.dy/2,y=A.target.y+A.ty+A.dy/2;return"M"+x+","+z+"C"+u+","+z+" "+t+","+y+" "+w+","+y}r.curvature=function(t){if(!arguments.length){return s}s=+t;return r};return r};function c(){d.forEach(function(r){r.sourceLinks=[];r.targetLinks=[]});n.forEach(function(r){var s=r.source,t=r.target;if(typeof s==="number"){s=r.source=d[r.source]}if(typeof t==="number"){t=r.target=d[r.target]}s.sourceLinks.push(r);t.targetLinks.push(r)})}function h(){d.forEach(function(r){r.value=Math.max(d3.sum(r.sourceLinks,k),d3.sum(r.targetLinks,k))})}function g(){var s=d,t,r=0;while(s.length){t=[];s.forEach(function(u){u.x=r;u.dx=l;u.sourceLinks.forEach(function(v){t.push(v.target)})});s=t;++r}i(r);e((p[0]-l)/(r-1))}function j(){d.forEach(function(r){if(!r.targetLinks.length){r.x=d3.min(r.sourceLinks,function(s){return s.target.x})-1}})}function i(r){d.forEach(function(s){if(!s.sourceLinks.length){s.x=r-1}})}function e(r){d.forEach(function(s){s.x*=r})}function m(v){var t=d3.nest().key(function(w){return w.x}).sortKeys(d3.ascending).entries(d).map(function(w){return w.values});v=v!=="undefined"?v:5;var u,s=p[1];tooShort=true;while(tooShort){var r=Number.POSITIVE_INFINITY;u=d3.min(t,function(w){return(s-(w.length-1)*f)/d3.sum(w,k)});t.forEach(function(w){w.forEach(function(y,x){y.y=x;y.dy=y.value*u;if(y.dy<r){r=y.dy}})});if(r<v){s+=20;continue}r=Number.POSITIVE_INFINITY;n.forEach(function(w){w.dy=w.value*u});tooShort=false}return s}function o(w){var r=d3.nest().key(function(z){return z.x}).sortKeys(d3.ascending).entries(d).map(function(z){return z.values});u();y();for(var x=1;w>0;--w){s(x*=0.99);y();t(x);y()}function u(){var z=d3.min(r,function(A){return(p[1]-(A.length-1)*f)/d3.sum(A,k)});r.forEach(function(A){A.forEach(function(C,B){C.y=B;C.dy=C.value*z})});n.forEach(function(A){A.dy=A.value*z})}function t(A){r.forEach(function(B,C){B.forEach(function(D){if(D.targetLinks.length){var E=d3.sum(D.targetLinks,z)/d3.sum(D.targetLinks,k);D.y+=(E-a(D))*A}})});function z(B){return a(B.source)*B.value}}function s(A){r.slice().reverse().forEach(function(B){B.forEach(function(C){if(C.sourceLinks.length){var D=d3.sum(C.sourceLinks,z)/d3.sum(C.sourceLinks,k);C.y+=(D-a(C))*A}})});function z(B){return a(B.target)*B.value}}function y(){r.forEach(function(A){var D,z,C=0,E=A.length,B;A.sort(v);for(B=0;B<E;++B){D=A[B];z=C-D.y;if(z>0){D.y+=z}C=D.y+D.dy+f}z=C-f-p[1];if(z>0){C=D.y-=z;for(B=E-2;B>=0;--B){D=A[B];z=D.y+D.dy+f-C;if(z>0){D.y-=z}C=D.y}}})}function v(A,z){return A.y-z.y}}function b(){d.forEach(function(t){t.sourceLinks.sort(r);t.targetLinks.sort(s)});d.forEach(function(u){var v=0,t=0;u.sourceLinks.forEach(function(w){w.sy=v;v+=w.dy});u.targetLinks.forEach(function(w){w.ty=t;t+=w.dy})});function s(u,t){return u.source.y-t.source.y}function r(u,t){return u.target.y-t.target.y}}function a(r){return r.y+r.dy/2}function k(r){return r.value}return q};