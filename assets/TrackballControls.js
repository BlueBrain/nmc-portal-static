THREE.TrackballControls=function(y,x){var o=this;var p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=y;this.domElement=(x!==undefined)?x:document;this.enabled=true;this.screen={width:0,height:0,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.eye=new THREE.Vector3();this.target=new THREE.Vector3();var h=new THREE.Vector3();var q=p.NONE,j=p.NONE,m=new THREE.Vector3(),g=new THREE.Vector3(),i=new THREE.Vector2(),t=new THREE.Vector2(),e=0,a=0,b=new THREE.Vector2(),s=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var w={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;this.screen.offsetLeft=0;this.screen.offsetTop=0;this.radius=(this.screen.width+this.screen.height)/4};this.handleEvent=function(z){if(typeof this[z.type]=="function"){this[z.type](z)}};this.getMouseOnScreen=function(A,z){return new THREE.Vector2((A-o.screen.offsetLeft)/o.radius*0.5,(z-o.screen.offsetTop)/o.radius*0.5)};this.getMouseProjectionOnBall=function(D,B){var A=new THREE.Vector3((D-o.screen.width*0.5-o.screen.offsetLeft)/o.radius,(o.screen.height*0.5+o.screen.offsetTop-B)/o.radius,0);var C=A.length();if(C>1){A.normalize()}else{A.z=Math.sqrt(1-C*C)}this.eye.copy(o.object.position).sub(o.target);var z=o.object.up.clone().setLength(A.y);z.add(o.object.up.clone().cross(this.eye).setLength(A.x));z.add(this.eye.setLength(A.z));return z};this.rotateCamera=function(){var B=Math.acos(m.dot(g)/m.length()/g.length());if(B){var z=(new THREE.Vector3()).crossVectors(m,g).normalize(),A=new THREE.Quaternion();B*=o.rotateSpeed;A.setFromAxisAngle(z,-B);this.eye.applyQuaternion(A);o.object.up.applyQuaternion(A);g.applyQuaternion(A);if(o.staticMoving){m.copy(g)}else{A.setFromAxisAngle(z,B*(o.dynamicDampingFactor-1));m.applyQuaternion(A)}}};this.zoomCamera=function(){if(q===p.TOUCH_ZOOM){var z=e/a;e=a;this.eye.multiplyScalar(z)}else{var z=1+(t.y-i.y)*o.zoomSpeed;if(z!==1&&z>0){this.eye.multiplyScalar(z);if(o.staticMoving){i.copy(t)}else{i.y+=(t.y-i.y)*this.dynamicDampingFactor}}}};this.panCamera=function(){var z=s.clone().sub(b);if(z.lengthSq()){z.multiplyScalar(this.eye.length()*o.panSpeed);var A=this.eye.clone().cross(o.object.up).setLength(z.x);A.add(o.object.up.clone().setLength(z.y));o.object.position.add(A);o.target.add(A);if(o.staticMoving){b=s}else{b.add(z.subVectors(s,b).multiplyScalar(o.dynamicDampingFactor))}}};this.checkDistances=function(){if(!o.noZoom||!o.noPan){if(o.object.position.lengthSq()>o.maxDistance*o.maxDistance){o.object.position.setLength(o.maxDistance)}if(this.eye.lengthSq()<o.minDistance*o.minDistance){o.object.position.addVectors(o.target,this.eye.setLength(o.minDistance))}}};this.update=function(){this.eye.subVectors(o.object.position,o.target);if(!o.noRotate){o.rotateCamera()}if(!o.noZoom){o.zoomCamera()}if(!o.noPan){o.panCamera()}o.object.position.addVectors(o.target,this.eye);o.checkDistances();o.object.lookAt(o.target);if(h.distanceToSquared(o.object.position)>0){o.dispatchEvent(w);h.copy(o.object.position)}};this.reset=function(){q=p.NONE;j=p.NONE;o.target.copy(o.target0);o.object.position.copy(o.position0);o.object.up.copy(o.up0);this.eye.subVectors(o.object.position,o.target);o.object.lookAt(o.target);o.dispatchEvent(w);h.copy(o.object.position)};function f(z){if(o.enabled===false){return}window.removeEventListener("keydown",f);j=q;if(q!==p.NONE){return}else{if(z.keyCode===o.keys[p.ROTATE]&&!o.noRotate){q=p.ROTATE}else{if(z.keyCode===o.keys[p.ZOOM]&&!o.noZoom){q=p.ZOOM}else{if(z.keyCode===o.keys[p.PAN]&&!o.noPan){q=p.PAN}}}}}function c(z){if(o.enabled===false){return}q=j;window.addEventListener("keydown",f,false)}function l(z){if(o.enabled===false){return}z.preventDefault();z.stopPropagation();if(q===p.NONE){q=z.button}if(q===p.ROTATE&&!o.noRotate){m=g=o.getMouseProjectionOnBall(z.clientX,z.clientY)}else{if(q===p.ZOOM&&!o.noZoom){i=t=o.getMouseOnScreen(z.clientX,z.clientY)}else{if(q===p.PAN&&!o.noPan){b=s=o.getMouseOnScreen(z.clientX,z.clientY)}}}document.addEventListener("mousemove",u,false);document.addEventListener("mouseup",n,false)}function u(z){if(o.enabled===false){return}z.preventDefault();z.stopPropagation();if(q===p.ROTATE&&!o.noRotate){g=o.getMouseProjectionOnBall(z.clientX,z.clientY)}else{if(q===p.ZOOM&&!o.noZoom){t=o.getMouseOnScreen(z.clientX,z.clientY)}else{if(q===p.PAN&&!o.noPan){s=o.getMouseOnScreen(z.clientX,z.clientY)}}}}function n(z){if(o.enabled===false){return}z.preventDefault();z.stopPropagation();q=p.NONE;document.removeEventListener("mousemove",u);document.removeEventListener("mouseup",n)}function k(z){if(o.enabled===false){return}z.preventDefault();z.stopPropagation();var A=0;if(z.wheelDelta){A=z.wheelDelta/40}else{if(z.detail){A=-z.detail/3}}i.y+=A*0.01}function r(B){if(o.enabled===false){return}switch(B.touches.length){case 1:q=p.TOUCH_ROTATE;m=g=o.getMouseProjectionOnBall(B.touches[0].pageX,B.touches[0].pageY);break;case 2:q=p.TOUCH_ZOOM;var A=B.touches[0].pageX-B.touches[1].pageX;var z=B.touches[0].pageY-B.touches[1].pageY;a=e=Math.sqrt(A*A+z*z);break;case 3:q=p.TOUCH_PAN;b=s=o.getMouseOnScreen(B.touches[0].pageX,B.touches[0].pageY);break;default:q=p.NONE}}function d(B){if(o.enabled===false){return}B.preventDefault();B.stopPropagation();switch(B.touches.length){case 1:g=o.getMouseProjectionOnBall(B.touches[0].pageX,B.touches[0].pageY);break;case 2:var A=B.touches[0].pageX-B.touches[1].pageX;var z=B.touches[0].pageY-B.touches[1].pageY;a=Math.sqrt(A*A+z*z);break;case 3:s=o.getMouseOnScreen(B.touches[0].pageX,B.touches[0].pageY);break;default:q=p.NONE}}function v(z){if(o.enabled===false){return}switch(z.touches.length){case 1:m=g=o.getMouseProjectionOnBall(z.touches[0].pageX,z.touches[0].pageY);break;case 2:e=a=0;break;case 3:b=s=o.getMouseOnScreen(z.touches[0].pageX,z.touches[0].pageY);break}q=p.NONE}this.domElement.addEventListener("contextmenu",function(z){z.preventDefault()},false);this.domElement.addEventListener("mousedown",l,false);this.domElement.addEventListener("mousewheel",k,false);this.domElement.addEventListener("DOMMouseScroll",k,false);this.domElement.addEventListener("touchstart",r,false);this.domElement.addEventListener("touchend",v,false);this.domElement.addEventListener("touchmove",d,false);window.addEventListener("keydown",f,false);window.addEventListener("keyup",c,false);this.handleResize()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);